<!Doctype HTML>
<html>
<script type="text/javascript" src="lib/antlr3-all-patched.js"></script>
<script type="text/javascript" src="TAILLexer.js"></script>
<script type="text/javascript" src="TAILParser.js"></script>
 
<script type="text/javascript">
var parse = function () {
  var input = document.getElementById("input").value,
      cstream = new org.antlr.runtime.ANTLRStringStream(input),
      lexer = new TAILLexer(cstream),
      tstream = new org.antlr.runtime.CommonTokenStream(lexer),
      parser = new TAILParser(tstream);
  //parser.entry_rule();
  var dom;
  if(lexer.getErrors().length === 0){
  	dom = parser.expression_start(); // Edit this manually
  	if(parser.getErrors().length === 0){
  		document.getElementById("output").innerHTML = escapeHTML(domToPrettyText(dom));
  	} else{
  		console.log("Hello Parser!");
  		parser.getErrors().forEach(function(error){
  			console.log(error);
  		});
  	}
	} else {
		console.log("Hello Lexer!");
		lexer.getErrors().forEach(function(error){
			console.log(error);
		});
	}
}

// From Blockly core xml.js
/**
 * Converts a DOM structure into properly indented text.
 * @param {!Element} dom A tree of XML elements.
 * @return {string} Text representation.
 */
domToPrettyText = function(dom) {
  // This function is not guaranteed to be correct for all XML.
  // But it handles the XML that Blockly generates.
  var blob = domToText(dom);
  // Place every open and close tag on its own line.
  var lines = blob.split('<');
  // Indent every line.
  var indent = '';
  for (var x = 1; x < lines.length; x++) {
    var line = lines[x];
    if (line[0] == '/') {
      indent = indent.substring(2);
    }
    lines[x] = indent + '<' + line;
    if (line[0] != '/' && line.slice(-2) != '/>') {
      indent += '  ';
    }
  }
  // Pull simple tags back together.
  // E.g. <foo></foo>
  var text = lines.join('\n');
  text = text.replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g, '$1</$2>');
  // Trim leading blank line.
  return text.replace(/^\n/, '');
};

/**
 * Converts a DOM structure into plain text.
 * Currently the text format is fairly ugly: all one line with no whitespace.
 * @param {!Element} dom A tree of XML elements.
 * @return {string} Text representation.
 */
domToText = function(dom) {
  var oSerializer = new XMLSerializer();
  return oSerializer.serializeToString(dom);
};

// From http://forums.asp.net/t/1151879.aspx?HttpUtility+HtmlEncode+in+javaScript+                                              
function escapeHTML (str) {
  var div = document.createElement('div');
  var text = document.createTextNode(str);
  div.appendChild(text);
  return div.innerHTML;
}
</script>

<body>
  <textarea id="input" placeholder="Enter your input text to parse here..."></textarea>
  <button id="submit" onClick="parse();">Parse this Text!</button>
  <pre id="output">Output will go here....</pre>
</body>
</html>
